Matrix Setup
============
  os: [ubuntu-latest, macos-latest, windows-latest]
  python-version: ["3.10", "3.12"]
  fail-fast: false
  steps: checkout → setup-python → pip install -e ".[test]" → pytest -v --tb=short


Proactive Cross-Platform Review — Architect Findings
====================================================

1. Matrix coverage: Run tests on ubuntu-latest, macos-latest, windows-latest × Python 3.10, 3.12.
   Catches path separators, line endings, and platform-specific behavior early.

2. Python versions: 3.10 and 3.12 cover the declared supported range (>=3.10) and the latest stable.

3. Dependencies: Use `pip install -e ".[test]"` to install the package with test extras; ensures
   pytest and project deps are available before running tests.

4. fail-fast: false — lets all matrix jobs complete so failures on one OS/Python combo don't hide others.


CI Run Summary (gh run 22198081835)
===================================
Run: https://github.com/ikamensh/kodo/actions/runs/22198081835
Triggered: push (ci: cross-platform test matrix)

JOBS
  ✓ test (macos-latest, 3.12) — 43s
  ✓ test (ubuntu-latest, 3.12) — 1m3s
  ✗ test (windows-latest, 3.10) — pytest exit 1
  ✗ test (windows-latest, 3.12) — pytest exit 1
  ✗ test (ubuntu-latest, 3.10) — pytest exit 1
  ✗ test (macos-latest, 3.10) — pytest exit 1

Result: 2 passed, 4 failed. Python 3.12 on ubuntu/macos passed; Python 3.10 and Windows need investigation.


Failure Logs (extracted from gh run view 22198081835 --log-failed)
==================================================================

--- Windows (3.10 and 3.12) ---

1. simple_term_menu / termios (5 tests)
   Tests: test_looks_staged, test_parse_goal_plan, test_parse_goal_plan_skips_incomplete_stages,
          test_parse_goal_plan_no_context_returns_empty, test_load_goal_plan
   Root cause: kodo.cli imports TerminalMenu from simple_term_menu, which imports termios.
   termios is Unix-only; on Windows it raises:
     ModuleNotFoundError: No module named 'termios'
   simple_term_menu then raises:
     NotImplementedError: "Windows" is currently not supported.
   Traceback (test_looks_staged):
     tests\test_staged_run.py:387: in test_looks_staged
       from kodo.cli import _looks_staged
     kodo\cli.py:15: in <module>
       from simple_term_menu import TerminalMenu
     simple_term_menu.py:37: in <module>
       import termios
     E   ModuleNotFoundError: No module named 'termios'
   Action: Lazy-import or mock simple_term_menu in tests; or skip CLI tests on Windows; or
   use a Windows-compatible menu library.

2. test_agent_timeout_returns_error (Windows 3.10 only in this run; Windows 3.12 passes this)
   Traceback:
     tests\test_agent.py:70: in test_agent_timeout_returns_error
       result = agent.run("do something", tmp_project, agent_name="test")
     kodo\agent.py:106: in run
       query_result = future.result(timeout=self.timeout_s)
     concurrent\futures\_base.py:460: in result
       raise TimeoutError()
   E   concurrent.futures._base.TimeoutError
   Action: Test expects agent to catch timeout and return error result; instead TimeoutError
   propagates. Increase test timeout or ensure mock session blocks long enough for timeout path.

--- Python 3.10 (ubuntu-latest, macos-latest) ---

3. test_agent_timeout_returns_error
   Traceback:
     tests/test_agent.py:70: in test_agent_timeout_returns_error
       result = agent.run("do something", tmp_project, agent_name="test")
     kodo/agent.py:106: in run
       query_result = future.result(timeout=self.timeout_s)
     concurrent/futures/_base.py:460: in result
       raise TimeoutError()
   E   concurrent.futures._base.TimeoutError
   Action: Flaky on 3.10 CI — timeout (0.01s) may fire before mock returns. Test passes on 3.12.
   Consider: increase timeout in test, or mark as xfail on slow runners, or fix agent to catch
   TimeoutError and return error result instead of propagating.
